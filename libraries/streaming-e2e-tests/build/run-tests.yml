# Run Tests navigating to a React App that uses DLJS with the latest
# nightly version of `botframework-streaming`

steps:
  - task: DownloadPipelineArtifact@2
    displayName: Download ReactApp Artifact
    inputs:
      artifact: ReactApp
      path: $(ReactProjectDir)/build

  - powershell: start powershell {npx serve -p 3000}
    displayName: 'npx serve -p 3000'
    workingDirectory: $(ReactProjectDir)/build

  - script: npm ci
    displayName: npm ci in TestsDir
    workingDirectory: $(TestsDir)

  - script: curl --silent --connect-timeout 5 --max-time 10 --retry 15 --retry-delay 0 --retry-max-time 120 --retry-connrefused "http://localhost:3000"
    displayName: wait for react app to start

  - script: npm test
    workingDirectory: $(TestsDir)
